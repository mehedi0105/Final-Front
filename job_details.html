<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Freelance Marketplace</title>

    <!-- Custom link File(start) -->

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="index.css" />
    <link rel="stylesheet" href="job_details.css" />

    <style>
          .navbar-expand-lg .navbar-nav .dropdown-menu {
            margin-right: 4%;
    padding: 15px 23px;
    margin-top: -820px;
    }
    </style>

    <!-- Custom link File(end) -->
  </head>
  <body>
    <header>
      <!-- <div id="navigation-bar"></div> -->
      <nav
        class="navbar navbar-expand-lg navbar-light bg-white"
        style="position: static"
      >
        <div class="container" id="navigation-bar"></div>
      </nav>
    </header>

    <main id="job_main">
 
    </main>
  

    <section>
      <div class="modal fade" id="applyModal" tabindex="-1" aria-labelledby="applyModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content" style="border: none;">
            <div class="modal-header">
              <h5 class="modal-title small-dialog-headline" id="applyModalLabel">Apply For This Job</h5>
              <button type="button" class="btn-close mfp-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="d-flex mb-3">
              </div>
              <form id="submit-proposal" onsubmit="handleApplyJob(event)">
                <div class="mb-3">
                  <textarea class="form-control" id="cover-latter" rows="5" name="cover-latter" placeholder="Your cover letter/message sent to the employer"></textarea>
                </div>
                <div class="modal-footer">
                  <button type="submit" class="btn" style="background-color: #26ae61; color: white; width: 100%;">Send application</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>

     <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-2">
            <h5>For Candidates</h5>
            <ul class="list-unstyled">
              <li><a href="#">Browse Jobs</a></li>
              <li><a href="#">Add Resume</a></li>
              <li><a href="#">Candidate Dashboard</a></li>
              <li><a href="#">Job Alerts</a></li>
              <li><a href="#">My Bookmarks</a></li>
            </ul>
          </div>
          <div class="col-md-2">
            <h5>For Employers</h5>
            <ul class="list-unstyled">
              <li><a href="#">Browse Candidates</a></li>
              <li><a href="#">Employer Dashboard</a></li>
              <li><a href="#">Add Job</a></li>
              <li><a href="#">Job Packages</a></li>
            </ul>
          </div>
          <div class="col-md-2">
            <h5>Other</h5>
            <ul class="list-unstyled">
              <li><a href="#">Job Page</a></li>
              <li><a href="#">Task Page</a></li>
              <li><a href="#">Resume Page</a></li>
              <li><a href="#">Blog</a></li>
              <li><a href="#">Contact</a></li>
            </ul>
          </div>
          <div class="col-md-2">
            <h5>Legal</h5>
            <ul class="list-unstyled">
              <li><a href="#">Privacy Policy</a></li>
              <li><a href="#">Terms of Use</a></li>
              <li><a href="#">FAQ</a></li>
            </ul>
          </div>
          <div class="col-md-4">
            <h5>Sign Up For a Newsletter</h5>
            <form class="form-inline">
              <input
                type="email"
                style="background-color: #909090"
                class="form-control mb-2 mr-sm-2"
                placeholder="Enter your email here"
              />
              <button type="submit" class="btn btn-primary mb-2">
                Subscribe
              </button>
            </form>
          </div>
        </div>

       <div class="col-md-6 text-md-right social-icons">
                  <a href="#"><i class="fab fa-facebook-f"></i></a>
                  <a href="#"><i class="fab fa-twitter"></i></a>
                  <a href="#"><i class="fab fa-linkedin-in"></i></a>
                  <a href="#"><i class="fab fa-instagram"></i></a>
              </div>
          </div> 
        <div class="row mt-4">
          <div class="col-md-12 text-center">
            <p
              style="
                color: #909090;
                border-top: 1px solid gray;
                padding-top: 10px;
              "
            >
              ¬© 2024 Your Company. All Rights Reserved.
            </p>
          </div>
        </div>
      </div>
    </footer>
    <!-- Custom Script File(start) -->
    <script>
      const getIdSendUsername = (id) =>{
         return fetch(`https://final-s1v0.onrender.com/getUserName/${id}/`)
              .then((res)=>res.json())
              .then((data)=>{
                  return data.username;
              });
      }

      const getIdSendTittle = (id) =>{
        return fetch(`https://final-s1v0.onrender.com/seller/jobDetails/${id}/`)
          .then((res) => res.json())
          .then((data) => {
              return data.tittle;
          })
      }
      
      window.onload = () =>{
          const id = localStorage.getItem('job_id');
          const parent = document.getElementById("job_main");
          const token = localStorage.getItem("token");
          const user_type = localStorage.getItem("user_type");
      
          if (parent.innerHTML !== "") {
              parent.innerHTML = "";
          }
      
          fetch(`https://final-s1v0.onrender.com/seller/jobDetails/${id}/`)
          .then((res) => res.json())
          .then(async (data) => {
              if (user_type === "seller") {
                  const company_name = await getIdSendUsername(data.company);
      
                  const div = document.createElement("div");
                  div.innerHTML = `
                      <div class="container my-5">
                          <div class="d-flex justify-content-between align-items-center">
                              <div>
                                  <h6 class="text-muted">Food Services</h6>
                                  <h3 style="font-size:17px;">${data.tittle}</h3>
                                  <span class="badge badge-primary">${data.type}</span>
                              </div>
                              <div></div>
                          </div>
      
                          <div class="card top-box mt-4" style="border: none">
                              <div class="card-body top-box-body d-flex">
                                  <div class="mr-4">
                                      <img class="company_logo"
                                           src="https://workscout.in/wp-content/uploads/job-manager-uploads/company_logo/2021/11/company-logo-03-150x150.png"
                                           height="117px;" alt=""/>
                                  </div>
                                  <div class="flex-grow-1">
                                      <h5>${company_name}</h5>
                                      <p class="text-muted">${company_name} in tech industry</p>
                                      <div class="d-flex mb-3">
                                          <a href="#" class="btn btn-light btn-sm mr-2">üåê Website</a>
                                          <a href="#" class="btn btn-light btn-sm mr-2">‚úâÔ∏è ${company_name}@test.com</a>
                                          <a href="#" class="btn btn-light btn-sm mr-2">üê¶ Twitter</a>
                                          <a href="#" class="btn btn-light btn-sm mr-2">üìò Facebook</a>
                                          <a href="#" class="btn btn-light btn-sm">üìû 123456789</a>
                                      </div>
                                  </div>
                                  <div>
                                    <button type="button" class="btn text-white" style="background-color: #26ae61; padding: 15px" data-bs-toggle="modal" data-bs-target="#applyModal">Apply For Job</button>
                                  </div>
                              </div>
                          </div>
                      </div>
      
                      <div class="container my-5">
                          <div class="row">
                              <div class="col-lg-8">
                                  <p class="Description">${data.description}</p>
                              </div>
                              <div class="col-lg-4">
                                  <div class="card" style="background: #fdfdfd;border: none;">
                                      <div class="card-body">
                                          <h5 class="card-title">Job Overview</h5>
                                          <ul class="list-unstyled job-overview">
                                              <li><i class="fas fa-calendar-alt job-overview-icon"></i> Date Posted: <br>
                                                  <span class="text-muted" style="margin-left: 46px;">Posted 1 day ago</span>
                                              </li>
                                              <li><i class="fas fa-clock job-overview-icon"></i> Expiration date: <br>
                                                  <span class="text-muted" style="margin-left: 46px;">April 15, 2027</span>
                                              </li>
                                              <li><i class="fas fa-map-marker-alt job-overview-icon"></i> Location:  <br>
                                                  <span class="text-muted" style="margin-left: 46px;">${data.location}</span>
                                              </li>
                                              <li><i class="fas fa-briefcase job-overview-icon"></i> Job Title: <br>
                                                  <span class="text-muted" style="margin-left: 46px;">${data.tittle.slice(0,40)}</span>
                                              </li>
                                              <li><i class="fas fa-dollar-sign job-overview-icon"></i> Salary: <br>
                                                  <span class="text-muted" style="margin-left: 46px;">${data.salary}</span>
                                              </li>
                                          </ul>
                                          <button type="button" class="btn text-white" style="background-color: #26ae61; padding: 15px; display:block;width: 100%;" data-bs-toggle="modal" data-bs-target="#applyModal">Apply For Job</button>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  `;
                  parent.appendChild(div);
              }
              else{
                  const company_name = await getIdSendUsername(data.company);
      
                  const div = document.createElement("div");
                  div.innerHTML = `
                      <div class="container my-5">
                          <div class="d-flex justify-content-between align-items-center">
                              <div>
                                  <h6 class="text-muted">Food Services</h6>
                                  <h3 style="font-size:17px;">${data.tittle}</h3>
                                  <span class="badge badge-primary">${data.type}</span>
                              </div>
                              <div></div>
                          </div>
      
                          <div class="card top-box mt-4" style="border: none">
                              <div class="card-body top-box-body d-flex">
                                  <div class="mr-4">
                                      <img class="company_logo"
                                           src="https://workscout.in/wp-content/uploads/job-manager-uploads/company_logo/2021/11/company-logo-03-150x150.png"
                                           height="117px;" alt=""/>
                                  </div>
                                  <div class="flex-grow-1">
                                      <h5>${company_name}</h5>
                                      <p class="text-muted">${company_name} in tech industry</p>
                                      <div class="d-flex mb-3">
                                          <a href="#" class="btn btn-light btn-sm mr-2">üåê Website</a>
                                          <a href="#" class="btn btn-light btn-sm mr-2">‚úâÔ∏è ${company_name}@test.com</a>
                                          <a href="#" class="btn btn-light btn-sm mr-2">üê¶ Twitter</a>
                                          <a href="#" class="btn btn-light btn-sm mr-2">üìò Facebook</a>
                                          <a href="#" class="btn btn-light btn-sm">üìû 123456789</a>
                                      </div>
                                  </div>
                                  <div>
                                     <button type="button" class="btn text-white" style="background-color: #26ae61; padding: 15px; display:block;width: 100%;" onclick="viewProposal(${data.id})">View Proposal List</button>
                                  </div>
                              </div>
                          </div>
                      </div>
      
                      <div class="container my-5">
                          <div class="row">
                              <div class="col-lg-8">
                                  <p class="Description">${data.description}</p>
                              </div>
                              <div class="col-lg-4">
                                  <div class="card" style="background: #fdfdfd;border: none;">
                                      <div class="card-body">
                                          <h5 class="card-title">Job Overview</h5>
                                          <ul class="list-unstyled job-overview">
                                              <li><i class="fas fa-calendar-alt job-overview-icon"></i> Date Posted: <br>
                                                  <span class="text-muted" style="margin-left: 46px;">Posted 1 day ago</span>
                                              </li>
                                              <li><i class="fas fa-clock job-overview-icon"></i> Expiration date: <br>
                                                  <span class="text-muted" style="margin-left: 46px;">April 15, 2027</span>
                                              </li>
                                              <li><i class="fas fa-map-marker-alt job-overview-icon"></i> Location:  <br>
                                                  <span class="text-muted" style="margin-left: 46px;">${data.location}</span>
                                              </li>
                                              <li><i class="fas fa-briefcase job-overview-icon"></i> Job Title: <br>
                                                  <span class="text-muted" style="margin-left: 46px;">${data.tittle.slice(0,40)}</span>
                                              </li>
                                              <li><i class="fas fa-dollar-sign job-overview-icon"></i> Salary: <br>
                                                  <span class="text-muted" style="margin-left: 46px;">${data.salary}</span>
                                              </li>
                                          </ul>
                                          <button type="button" class="btn text-white" style="background-color: #26ae61; padding: 15px; display:block;width: 100%;" onclick="viewProposal(${data.id})">View Proposal List</button>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div id="proposal-list"><div>
                      </div>
                  `;
                  parent.appendChild(div);                
              }
          });
      }

  const handleApplyJob =async (event) =>{
    event.preventDefault();
    const seller = localStorage.getItem("user_id");
    const job_id = localStorage.getItem("job_id");
    // const title = await getIdSendTittle(job_id);
    // console.log(seller," ",job_id," ",title);
    const form = document.getElementById("submit-proposal");
    const form_data = new FormData(form);

    const JobApplyForm = {
      "cover_letter": form_data.get("cover-latter"),
      "is_accepted": false,
      "job": job_id,
      "seller": seller,
    };
    console.log(JobApplyForm);

    fetch("https://final-s1v0.onrender.com/seller/apply_job/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify(JobApplyForm),
    }
    )
        .then((res) => res.json())
        .then((data) => {
            alert("Your Proposal Submited Successfuly");
            // window.location.href = "./browse_job.html"
        })
        .catch((error) => {
            console.error(error);
        });

  }

  const viewProposal = (id) =>{
    const parent = document.getElementById("proposal-list");
    if(parent){
      if (parent.innerHTML !== "") {
              parent.innerHTML = "";
          }
        console.log(id)
      fetch("https://final-s1v0.onrender.com/seller/apply_job/")
        .then((res)=>res.json())
        .then((data)=>{
          data.forEach(async(element) => {
            console.log("job",element.job)
            if(element.job == String(id)){
              const company_name = await getIdSendUsername(element.seller);
              const div = document.createElement("div");
              div.innerHTML = `
              <ul class="dashboard-box-list" style="cursor:pointer;" onclick="transerViewProposal(${element.id})">
                  <div class="my-bid-bottoms">
                    <div class="card mb-3 job-card" style="border-left: 5px solid #FFDD57;     background-color: rgba(80, 80, 80,0.05)">
                      <div class="card-body d-flex justify-content-between align-items-center">
                          <div class="d-flex">
                              <img src="https://workscout.in/wp-content/uploads/job-manager-uploads/company_logo/2021/11/company-logo-03-150x150.png" alt="King Logo" class="me-3" style="height: 60px;">
                              <div style="padding-left: 25px;">
                                  <h5 class="card-title">${company_name} </h5>
                                  <p class="card-text d-flex gap-2" style="color: #808080;">
                                      <small class="text-muted">Company: ${element.cover_letter.slice(0,100)}........</small><br>
                                      
                                  </p>
                              </div>
                          </div>
                          <div class="d-flex flex-column text-end">
                              <span class="badge bg-primary mb-1">View Proposal</span>
                          </div>
                      </div>
                  </div>
                  </div>
                </ul>
              `
              parent.appendChild(div);
            }
          });
          if (parent.innerHTML === "") {
              alert("Data Not Found")
          }

        })
    }
  }

  const transerViewProposal = (pk) =>{
    localStorage.setItem("apply_id",pk);
    window.location.href = "./veiw_proposal.html";
  }
      </script>
      
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script src="./app.js"></script>

    <!-- Custom Script File(start) -->
  </body>
</html>
